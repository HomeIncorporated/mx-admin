import{d as o,Y as B,b as F,as as T,R as u,Z as k,w as x,o as C,a3 as N,e as t,al as E,C as D,k as R,h as f,v as q,f as r,bq as M,a1 as A,i as O,B as j}from"./index-IRfrO0r8.js";import{S as P,b as V,c as K,d as L}from"./index-XBffZLXW.js";const z=new Map([[P,"博文"],[V,"手记"],[K,"速记"],[L,"说说"]]);function p(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!q(a)}const _=o({setup(){const a=B(),s=F(!1);T(async()=>{const e=await u.api.subscribe.status.get().then(c=>c.enable);s.value=e});const n=async()=>{await u.api.options("featureList").patch({data:{emailSubscribe:!s.value}}),s.value=!s.value},{loading:g,checkedRowKeys:m,data:y,pager:l,fetchDataFn:d}=k((e,c)=>async(w=a.query.page||1,S=10)=>{const b=await u.api.subscribe.get({params:{page:w,size:S,sortBy:"created",sortOrder:"-1"}});e.value=b.data,c.value=b.pagination}),i=d;x(()=>a.query.page,async e=>{await i(e)}),C(async()=>{await d()});const h=N(()=>[{title:"邮箱",key:"email",ellipsis:{tooltip:!0},width:140},{title:"订阅内容",key:"subscribe",width:250,render(e){return t(U,{bit:e.subscribe},null)}},{title:"创建于",width:250,key:"created",sortOrder:"descend",render(e){return t(A,{time:e.created},null)}},{title:"操作",fixed:"right",width:40,key:"id",render(e){return t(f,null,{default:()=>[t(O,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await u.api.subscribe.unsubscribe.get({params:{email:e.email,cancelToken:e.cancelToken}}),message.success("删除成功"),await i(l.value.currentPage)}},{trigger:()=>t(j,{quaternary:!0,type:"error",size:"tiny"},{default:()=>[r("移除")]}),default:()=>t("span",{class:"max-w-48"},[r("确定要删除 "),e.title,r("？")])})]})}}]),v=o(()=>()=>t("div",{class:"inline-flex items-center"},[t("span",null,[r("邮件订阅开启状态：")]),t(M,{value:s.value,onChange:n},null)]));return()=>t(D,{description:t(v,null,null)},{default:()=>[t(E,{data:y,loading:g.value,columns:h.value,onFetchData:i,pager:l,onUpdateCheckedRowKeys:e=>{m.value=e}},null)]})}}),U=o({props:{bit:{type:Number,required:!0}},render(){const a=[];for(const[s,n]of z.entries())s&this.bit&&a.push(t(R,{round:!0},p(n)?n:{default:()=>[n]}));return t(f,null,p(a)?a:{default:()=>[a]})}});export{U as SubscribeBit,_ as default};
